                           +--------------------------+
                           |           start          |
                           +-------------+------------+
                                         |
                           +-------------v------------+
+------------------------> |           loop           |
|                          +-------------+------------+
|                                        |
|                          +-------------v------------+
|                          |    create ram image      |
|                          |    at ./mnt/img.bin      |
|                          +-------------+------------+
|                                        |
|                    +-------------------+---------------+
|                    |                                   |
|      +--------------------------+        +-------------v-------------+
|      |      issue nvme write    | <-+    | start ThreadDoPowerOff()  |
|      +---------------------------   |    +-------------+-------------+
|                    |                |                  |
|   No +-------------v------------+   |                  |
|   +--+       write success?     |   |    +-------------+-------------+
|   |  +-------------+------------+   |    |     wait for time up      |
|   |                | Yes            |    +-------------+-------------+
|   |  +-------------v------------+   |                  |
|   |  |   delay writeDelayTime   |   |                  |
|   |  |  and write to ram image  +---+    +-------------v-------------+
|   |  +--------------------------+        |        POR/SPOR off       |
|   |                                      +-------------+-------------+
|   +---------------+                                    |
|                   |                                    |
|     +-------------+------------+         +-------------v-------------+
|     |        wait for          |         |      delay poroffdur      |
|     | ThreadDoPowerOff() finish|         +-------------+-------------+
|     +-------------+------------+                       |
|                   |                                    |
|     +--------------------------+         +-------------v-------------+
|     |      check nvme disk     | No      |        POR/SPOR on        |
|     |      with ram image      +---+     +-------------+-------------+
|     |   and Verification pass? |   |                   |
|     +-------------+------------+   |                   |
|                   | Yes            |     +-------------v-------------+
|  No +-------------+------------+   |     | finish ThreadDoPowerOff() |
+-----+      Is last loop?       |   |     +---------------------------+
      +-------------+------------+   |
                    | Yes            |
      +-------------v------------+   |
      |            END           | <-+
      +--------------------------+

